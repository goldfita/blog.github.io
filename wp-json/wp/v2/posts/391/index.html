{"id":391,"date":"2023-05-10T12:02:14","date_gmt":"2023-05-10T16:02:14","guid":{"rendered":"https:\/\/blog.signalsguru.net\/?p=391"},"modified":"2023-05-10T12:02:14","modified_gmt":"2023-05-10T16:02:14","slug":"ansible-verbosity-and-tags","status":"publish","type":"post","link":"http:\/\/blog.signalsguru.net\/archives\/391","title":{"rendered":"Ansible Verbosity and Tags"},"content":{"rendered":"\n<p>A question that sometimes comes up on the forums about Ansible is how to cut down on its verbose output, especially how to suppress output for skipped tasks. One solution to this problem is to use <mark style=\"background-color:rgba(0, 0, 0, 0)\" class=\"has-inline-color has-ast-global-color-0-color\">tags <\/mark>instead of <mark style=\"background-color:rgba(0, 0, 0, 0)\" class=\"has-inline-color has-ast-global-color-0-color\">when<\/mark>. Tags allow you to bypass a task completely, as if it weren&#8217;t even in the file. However, there are some caveats. The following snippet demonstrates how this works.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code><mark style=\"background-color:rgba(0, 0, 0, 0)\" class=\"has-inline-color has-ast-global-color-0-color\">- set_fact:\n    skip2: false\n\n- tags: '{{\"always\" if skip is undefined else \"never\"}}'\n  debug:\n    msg: 'Tag skip not skipped ({{skip is undefined}})'\n\n- tags: '{{\"always\" if skip2 is undefined else \"never\"}}'\n  debug:\n    msg: 'Tag skip2 not skipped ({{skip2 is undefined}})'\n\n- when: skip is undefined\n  debug:\n    msg: 'When skip not skipped ({{skip is undefined}})'\n\n- when: skip2 is undefined\n  debug:\n    msg: 'When skip2 not skipped ({{skip2 is undefined}})'<\/mark><\/code><\/pre>\n\n\n\n<p>If you run this, defining skip at the command line, you see that both the whens are skipped as expected, but they still appear in the output. By contrast, the first skip does not appear at all, which is what we want. Notice, though, that even though skip2 is defined, the second tags debug runs. The tags are evaluated before the file is run, so you need to take this into account when deciding whether you want to use tags to skip a task.<\/p>\n\n\n\n<pre class=\"wp-block-code scroll\"><code>> <mark style=\"background-color:rgba(0, 0, 0, 0)\" class=\"has-inline-color has-ast-global-color-0-color\">ansible-playbook skip.yml -e \"skip=\"<\/mark>\n\nTASK &#91;set_fact] ********************************************************************************************************************************************************************\r\nok: &#91;localhost]\r\n\r\nTASK &#91;debug] ***********************************************************************************************************************************************************************\r\nok: &#91;localhost] => {\r\n    \"msg\": \"Tag skip2 not skipped (False)\"\r\n}\r\n\r\nTASK &#91;debug] ***********************************************************************************************************************************************************************\r\n<mark style=\"background-color:rgba(0, 0, 0, 0);color:#f20000\" class=\"has-inline-color\"><mark style=\"background-color:rgba(0, 0, 0, 0);color:#fb0404\" class=\"has-inline-color\">skipping<\/mark><\/mark>: &#91;localhost]\r\n\r\nTASK &#91;debug] ***********************************************************************************************************************************************************************\r\n<mark style=\"background-color:rgba(0, 0, 0, 0);color:#f20000\" class=\"has-inline-color\"><mark style=\"background-color:rgba(0, 0, 0, 0);color:#fb0404\" class=\"has-inline-color\">skipping<\/mark><\/mark>: &#91;localhost]<\/code><\/pre>\n\n\n\n<p>If you run this without defining skip, you get the output below, which does run the first tags. So it&#8217;s clear that you can use tags to get a similar behavior to when but without the undesirable verbosity. There is one more caveat. It appears that you can only use the fact that a variable is bound or not. If you try to use the value of the variable to control the tags, it won&#8217;t work.<\/p>\n\n\n\n<pre class=\"wp-block-code scroll\"><code>> <mark style=\"background-color:rgba(0, 0, 0, 0)\" class=\"has-inline-color has-ast-global-color-0-color\">ansible-playbook skip.yml<\/mark>\n\nTASK &#91;set_fact] ********************************************************************************************************************************************************************\nok: &#91;localhost]\n\nTASK &#91;debug] ***********************************************************************************************************************************************************************\nok: &#91;localhost] => {\n    \"msg\": \"Tag skip not skipped (True)\"\n}\n\nTASK &#91;debug] ***********************************************************************************************************************************************************************\nok: &#91;localhost] => {\n    \"msg\": \"Tag skip2 not skipped (False)\"\n}\n\nTASK &#91;debug] ***********************************************************************************************************************************************************************\nok: &#91;localhost] => {\n    \"msg\": \"When skip not skipped (True)\"\n}\n\nTASK &#91;debug] ***********************************************************************************************************************************************************************\n<mark style=\"background-color:rgba(0, 0, 0, 0);color:#f20000\" class=\"has-inline-color\"><mark style=\"background-color:rgba(0, 0, 0, 0);color:#fb0404\" class=\"has-inline-color\">skipping<\/mark><\/mark>: &#91;localhost]<\/code><\/pre>\n\n\n\n<p>In some situations, the fact that tags are evaluated before the file runs may be desirable behavior. In the example below, I&#8217;m including a file recursively twice. The first time through, the include is run because first has not yet be defined when the tags are evaluated. The second time through, it skips the include because first was defined before the second recursive call. If you tried to do this in the exact same way using when, it wouldn&#8217;t work since first would be defined by the time the when is evaluated. In this case, you could probably come up with a slightly different way to make this work with when, but the point is that you can achieve different behavior by using tags instead.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code><mark style=\"background-color:rgba(0, 0, 0, 0)\" class=\"has-inline-color has-ast-global-color-0-color\">- debug:\n    msg: 'First attempt ({{first is undefined}})'\n\n- vars:\n    first: false\n  tags: '{{\"always\" if first is undefined else \"never\"}}'\n  include_tasks: try_something.yml<\/mark><\/code><\/pre>\n\n\n\n<pre class=\"wp-block-code scroll\"><code>TASK &#91;include_tasks] ***************************************************************************************************************************************************************\r\nincluded: \/home\/user\/try_something.yml for localhost\r\n\r\nTASK &#91;debug] ***********************************************************************************************************************************************************************\r\nok: &#91;localhost] => {\r\n    \"msg\": \"<mark style=\"background-color:rgba(0, 0, 0, 0);color:#fb0404\" class=\"has-inline-color\">First attempt (True)<\/mark>\"\r\n}\r\n\r\nTASK &#91;include_tasks] ***************************************************************************************************************************************************************\r\nincluded: \/home\/user\/try_something.yml for localhost\r\n\r\nTASK &#91;debug] ***********************************************************************************************************************************************************************\r\nok: &#91;localhost] => {\r\n    \"msg\": \"<mark style=\"background-color:rgba(0, 0, 0, 0);color:#fb0404\" class=\"has-inline-color\">First attempt (False)<\/mark>\"\r\n}<\/code><\/pre>\n","protected":false},"excerpt":{"rendered":"<p>A question that sometimes comes up on the forums about Ansible is how to cut down on its verbose output, especially how to suppress output for skipped tasks. One solution to this problem is to use tags instead of when. Tags allow you to bypass a task completely, as if it weren&#8217;t even in the &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"\" href=\"http:\/\/blog.signalsguru.net\/archives\/391\"> <span class=\"screen-reader-text\">Ansible Verbosity and Tags<\/span> Read More &raquo;<\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-global-header-display":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"default","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","footnotes":""},"categories":[12],"tags":[],"_links":{"self":[{"href":"http:\/\/blog.signalsguru.net\/wp-json\/wp\/v2\/posts\/391"}],"collection":[{"href":"http:\/\/blog.signalsguru.net\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/blog.signalsguru.net\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/blog.signalsguru.net\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/blog.signalsguru.net\/wp-json\/wp\/v2\/comments?post=391"}],"version-history":[{"count":3,"href":"http:\/\/blog.signalsguru.net\/wp-json\/wp\/v2\/posts\/391\/revisions"}],"predecessor-version":[{"id":394,"href":"http:\/\/blog.signalsguru.net\/wp-json\/wp\/v2\/posts\/391\/revisions\/394"}],"wp:attachment":[{"href":"http:\/\/blog.signalsguru.net\/wp-json\/wp\/v2\/media?parent=391"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/blog.signalsguru.net\/wp-json\/wp\/v2\/categories?post=391"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/blog.signalsguru.net\/wp-json\/wp\/v2\/tags?post=391"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}